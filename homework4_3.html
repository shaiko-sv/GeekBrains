<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
          crossorigin="anonymous">

    <title>Form validator</title>
    <style>
        #nameInput {
            text-transform: capitalize;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-sm-5">
            <form class="formRequest">
                <div class="form-group">
                    <label for="nameInput">Your name</label>
                    <input type="text" class="form-control" id="nameInput" placeholder="John Smith"
                           data-toggle="popover" title="Error!" data-trigger="manual"
                           data-content="">
                </div>
                <div class="form-group">
                    <label for="phoneInput">Phone number</label>
                    <input type="text" class="form-control" id="phoneInput" placeholder="+7(000)000-0000"
                           data-toggle="popover" title="Error!" data-trigger="manual"
                           data-content="">
                </div>
                <div class="form-group">
                    <label for="emailInput">Email address</label>
                    <input type="email" class="form-control" id="emailInput" aria-describedby="emailHelp"
                           placeholder="Enter email" data-toggle="popover" title="Error!" data-trigger="manual"
                           data-content="">
                    <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone
                        else.</small>
                </div>
                <div class="form-group">
                    <label for="passwordInput">Password</label>
                    <input type="password" class="form-control" id="passwordInput" placeholder="Password"
                           data-toggle="popover" title="Error!" data-trigger="manual"
                           data-content="">
                </div>
                <div class="form-group">
                    <label for="commentsInput">Comments</label>
                    <textarea class="form-control" id="commentsInput" rows="3"></textarea>
                </div>
                <div class="form-group form-check">
                    <input type="checkbox" class="form-check-input" id="formCheckBox">
                    <label class="form-check-label" for="formCheckBox" id="formCheckBoxLabel"
                           data-toggle="popover" title="Error!" data-trigger="manual"
                           data-content="You must check this checkbox...">Check me out</label>
                </div>
                <button action="#" id="btnSubmit" type="submit" class="btn btn-primary">Submit</button>
            </form>
        </div>
    </div>
</div>
<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script>
    "use strict";
    const d = document;

    $(function () {
        $('[data-toggle="popover"]').popover();
    });

    class FormValidator {
        constructor(container = '.formRequest') {
            this.block = d.querySelector(container);
            this.validatorResult = [];
            this.data = {
                name: '',
                phone: '',
                email: '',
                password: '',
                comments: '',
                check: false,
            };
            this.regexp = {
                name: /[a-zа-яёА-ЯЁ\s]+/,
                phone: /\+\d\(\d{3}\)\d{3}-\d{4}/,
                email: /[a-z]+[\.-]?[a-z]+@[a-z]+\.[a-z]{2,6}/,
                check: true,
            };
            this.alerts = {
                name: 'Имя должно содержать только буквы',
                phone: 'Телефон должен имеет вид +7(000)000-0000',
                email: 'E-mail должен иметь вид mymail@mail.ru, или my.mail@mail.ru, или my-mail@mail.ru',
            };
            this.submitForm = false;
            this.init();
        }
        init() {
            this.block.addEventListener('submit', e => {
                e.preventDefault();
                //console.log(e);
                this._dataRead();
                //console.log(this.data);
                this._dataValidator();
                return false;
            })
        }
        _dataRead() {
            let selector = '';
            for(let field in this.data) {
                if (field === 'check') {
                    this.data[field] = d.querySelector('#formCheckBox').checked;
                } else {
                selector = `#${field}Input`;
                this.data[field] = d.querySelector(selector).value;
                }
            }
        }
        _dataValidator() {
            let selector = '';
            let regexp = '';
            this.validatorResult = [];
            for(let field in this.regexp) {
                //console.log(field);
                if (field === 'check') {
                    if (this.data[field] !== this.regexp[field]) {
                        $('#formCheckBoxLabel').popover('show');
                        this.validatorResult.push(false);
                    } else {
                        this.validatorResult.push(true);
                        $('#formCheckBoxLabel').popover('hide')
                    }
                } else {
                    selector = `#${field}Input`;
                    let userData = this.data[field];
                    regexp = new RegExp(this.regexp[field], 'ig');
                    //console.log(regexp);
                    let regexpCheck = this.data[field].match(regexp);
                    //console.log(userData);
                    if (regexpCheck) {
                        //console.log(regexpCheck[0]);
                        regexpCheck = regexpCheck[0];
                        //console.log(d.querySelector(selector))
                        d.querySelector(selector).dataset.content = this.alerts[field];
                    } else {
                        if(userData) {
                            d.querySelector(selector).dataset.content = this.alerts[field];
                        } else {
                            d.querySelector(selector).dataset.content = 'This field cannot be empty!'
                    }
                    }
                    if(userData !== regexpCheck){
                        $(selector).popover('show');
                        $(selector).addClass('border-danger');
                        this.validatorResult.push(false);
                    } else {
                        $(selector).popover('hide');
                        $(selector).removeClass('border-danger');
                        this.validatorResult.push(true);
                    }
                }
            }
            // let str3 = 'color colour colotr';
            // let str4 = str3.replace(/\s+/g, '');
            // console.log(str4);
            // let a = str3.match(/colo[tu]?r/ig).join('');
            // console.log(a);
            // console.log(a === str4);
            this._validationCheck();
        }
        _validationCheck(){
            let controlSum = this.validatorResult.length;
            let resultSum = 0;
            for(let item of this.validatorResult){
                if(item){
                    resultSum += 1;
                }
            }
            if(resultSum === controlSum){
                this.block.submit();
                this.saveData();
            }
        }
        saveData() {
            // Получаем значения текстовых полей
            //var localData = document.getElementById("localData").value;
            //var sessionData = document.getElementById("sessionData").value;

            // Сохраняем текст, введенный в текстовом поле, в локальном хранилище
            localStorage["localData"] = this.data.name;

            // Сохраняем текст, введенный в текстовом поле, в хранилище сессий
            sessionStorage["sessionData"] = this.alerts.name;
        }
    }


    const formRequest = new FormValidator();

    // a. Имя содержит только буквы.
    let regexpName = /[a-zа-яёА-ЯЁ\s]+/i;

    // b. Телефон имеет вид +7(000)000-0000.
    let regexpPhone = /\+\d\(\d{3}\)\d{3}-\d{4}/;

    // c. E-mail имеет вид mymail@mail.ru, или my.mail@mail.ru, или my-mail@mail.ru.
    let regexpEmail = /[a-z]+[\.-]?[a-z]+@[a-z]+\.[a-z]{2,6}/ig; // short regexp for email validator /.+@.+\..+/i

    // d. Текст произвольный.
    // e. Если одно из полей не прошло валидацию, необходимо выделить это поле красной рамкой и сообщить пользователю об ошибке.
</script>
</body>
</html>